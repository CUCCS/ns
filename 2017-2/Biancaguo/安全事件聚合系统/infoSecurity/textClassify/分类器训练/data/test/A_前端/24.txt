题主说到了 DOM XSS，个人认为没有必要觉得什么都是不安全的，不安全来源于内容不可信，可信的内容自然是安全的。比如题主说到的 document.location= 这个操作，如果赋值是一个常量字符串，那么为什么不能用这个操作呢？DOM XSS 的确可能来自各种方面，但归结一下无非就是直接使用了一些不可信的内容，比如 JS 操作里直接用了未处理的 location.hash 拼在一个什么地方。所以还是像普通 XSS 那样对于不可信内容做好处理是非常重要的。