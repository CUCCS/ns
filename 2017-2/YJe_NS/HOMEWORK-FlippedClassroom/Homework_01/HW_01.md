# 实验一实验报告

## 实验要求
* 基于VirtualBox的网络攻防基础环境搭建实例讲解
    * 节点：靶机、网关、攻击者主机
    * 连通性
        * 靶机可以直接访问攻击者主机   （实现）
        * 攻击者主机无法直接访问靶机   （实现）
        * 网关可以直接访问攻击者主机和靶机  （实现）
        * 靶机的所有对外上下行流量必须经过网关 （实现）
        * 所有节点均可以访问互联网 （实现）
    * 其他要求
        * 所有节点制作成基础镜像（多重加载的虚拟硬盘） （实现）


## 实验拓扑

![](https://github.com/Anna-YJ/ns/blob/master/2017-2/YJe_NS/Picture/Flipped/1.png?raw=true)  

## 实验过程
* 靶机（KaliVictim)，网关（KaliGateway），攻击机（KaliAttack）设置如下
* 靶机（内部网络，手动设置ip），攻击机（NAT网络，自动获取ip），网关（NAT网络ip自动获取，内部网络ip手动设置）
![](https://github.com/Anna-YJ/ns/blob/master/2017-2/YJe_NS/Picture/Flipped/2.png?raw=true) 
![](https://github.com/Anna-YJ/ns/blob/master/2017-2/YJe_NS/Picture/Flipped/3.png?raw=true) 
![](https://github.com/Anna-YJ/ns/blob/master/2017-2/YJe_NS/Picture/Flipped/4.png?raw=true) 
![](https://github.com/Anna-YJ/ns/blob/master/2017-2/YJe_NS/Picture/Flipped/5.png?raw=true)
![](https://github.com/Anna-YJ/ns/blob/master/2017-2/YJe_NS/Picture/Flipped/6.png?raw=true)
![](https://github.com/Anna-YJ/ns/blob/master/2017-2/YJe_NS/Picture/Flipped/7.png?raw=true)
![](https://github.com/Anna-YJ/ns/blob/master/2017-2/YJe_NS/Picture/Flipped/8.png?raw=true)


 
* 设置靶机防火墙规则，使攻击者不能直接访问靶机
    * iptables -I INPUT -s 10.0.2.5 -j DROP

* 网关启用端口转发，实现靶机上网   
  * vim /etc/sysctl.conf ,将 net.ipv4.ip_forward = 1注释取消，执行sysctl -p /etc/sysctl.conf 使修改生效。
  * 配置iptables : iptables -t nat -A POSTROUTING -s 192.168.2.0/24 -j MASQUERADE
     
## 实验结果
* 靶机可以直接访问攻击者主机
![](https://github.com/Anna-YJ/ns/blob/master/2017-2/YJe_NS/Picture/Flipped/9.png?raw=true)

* 攻击者主机无法直接访问靶机 
![](https://github.com/Anna-YJ/ns/blob/master/2017-2/YJe_NS/Picture/Flipped/10.png?raw=true)

* 网关可以直接访问攻击者主机和靶机  
![](https://github.com/Anna-YJ/ns/blob/master/2017-2/YJe_NS/Picture/Flipped/11.png?raw=true)

* 靶机的所有对外上下行流量必须经过网关
![](https://github.com/Anna-YJ/ns/blob/master/2017-2/YJe_NS/Picture/Flipped/12.png?raw=true)

* 所有节点均可以访问互联网 
![](https://github.com/Anna-YJ/ns/blob/master/2017-2/YJe_NS/Picture/Flipped/13.png?raw=true)

* 所有节点制作成基础镜像（多重加载的虚拟硬盘）  
![](https://github.com/Anna-YJ/ns/blob/master/2017-2/YJe_NS/Picture/Flipped/14.png?raw=true)
![](https://github.com/Anna-YJ/ns/blob/master/2017-2/YJe_NS/Picture/Flipped/15.png?raw=true)
![](https://github.com/Anna-YJ/ns/blob/master/2017-2/YJe_NS/Picture/Flipped/16.png?raw=true)



## 实验心得
上次提交一直出现问题，发现是因为在启用端口转发时不是永久生效，导致我在下次开机后，net.ipv4.ip_forward 值不为一。修改过后，实现能够达到要求。

