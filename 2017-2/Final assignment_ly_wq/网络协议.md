# 网络协议

## 定义

> 网络协议为_计算机网络中进行数据交换而建立的规则、标准或约定的集合。_例如，网络中一个微机用户和一个大型主机的操作员进行通信，由于这两个数据终端所用字符集不同，因此操作员所输入的命令彼此不认识。为了能进行通信，规定每个终端都要将各自字符集中的字符先变换为标准字符集的字符后，才进入网络传送，到达目的终端之后，再变换为该终端字符集的字符。当然，对于不相容终端，除了需变换字符集字符外还需转换其他特性，如显示格式、行长、行数、屏幕滚动方式等也需作相应的变换。

## 要素

> 网络协议是由三个要素组成:
> 
1. 语义。
> 
> 语义是解释控制信息每个部分的意义。它规定了需要发出何种控制信息，以及完成的动作与做出什么样的响应。
> 
2.  语法。
> 
> 语法是用户数据与控制信息的结构与格式，以及数据出现的顺序。
> 
3. 时序。
> 
> 时序是对事件发生顺序的详细说明。（也可称为“同步”）。
> 
> 人们形象地把这三个要素描述为：语义表示要做什么，语法表示要怎么做，时序表示做的顺序。

## 工作方式

> 网络协议是网络上所有设备（网络服务器、计算机及交换机、路由器、防火墙等）之间通信规则的集合，它规定了通信时信息必须采用的格式和这些格式的意义。大多数网络都采用分层的体系结构，每一层都建立在它的下层之上，向它的上一层提供一定的服务，而把如何实现这一服务的细节对上一层加以屏蔽。一台设备上的第 n层与另一台设备上的第n层进行通信的规则就是第n层协议。在网络的各层中存在着许多协议，接收方和发送方同层的协议必须一致，否则一方将无法识别另一方发出的信息。网络协议使网络上各种设备能够相互交换信息。常见的协议有：TCP/IP协议、IPX/SPX协议、NetBEUI协议等。

## 层次结构

> 由于网络节点之间联系的复杂性，在制定协议时，通常把复杂成分分解成一些简单成分，然后再将它们复合起来。最常用的复合技术就是层次方式，网络协议的层次结构如下：
> 
1. 结构中的每一层都规定有明确的服务及接口标准。
2. 把用户的应用程序作为最高层
3. 除了最高层外，中间的每一层都向上一层提供服务，同时又是下一层的用户。
4. 把物理通信线路作为最低层，它使用从最高层传送来的参数，是提供服务的基础。

## 层次划分

> 为了使不同计算机厂家生产的计算机能够相互通信，以便在更大的范围内建立计算机网络，国际标准化组织（ISO）在1978年提出了“开放系统互联参考模型”，即著名的OSI/RM模型（Open System Interconnection/Reference Model）。它将计算机网络体系结构的通信协议划分为七层，自下而上依次为：物理层（Physics Layer）、数据链路层（Data Link Layer）、网络层（Network Layer）、传输层（Transport Layer）、会话层（Session Layer）、表示层（Presentation Layer）、应用层（Application Layer）。

###### OSI/RM模型
![](https://github.com/LuYe2/ns/blob/Final-assignment/2017-2/Final%20assignment_ly_wq/OSI%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B.jpg?raw=true)

### OSI/RM的各分层的作用

> 1. 物理层(PhysicalLayer)
> 
> 物理层关心的是：线路的规格、电压的高低、数据0，1如何表示、介质材料的指标、接口类型，引线的多少等，也就是说物理层是为上层提供一个物理链接，以及它们的机械、电气、功能特性。在物理层上，数据还没有被组织，仅作为原始的位流或电气电压处理，单位是比特。
 应用层（ApplicationLayer)
> 
> 2. 数据链路层（DataLinkLayer)
> 
> 数据链路层控制网络层与物理层之间的通信。它的主要功能是如何在不可靠的物理线路上进行数据的可靠传递。为了保证传输，从网络层接收到的数据被分割成特定的可被物理层传输的帧。帧是用来移动数据的结构包，它不仅包括原始数据，还包括发送方和接收方的物理地址以及纠错和控制信息。其中的地址确定了帧将发送到何处，而纠错和控制信息则确保帧无差错到达。如果在传送数据时，接收点检测到所传数据中有差错，就要通知发送方重发这一帧。这一层的主要作用有：物理寻址、数据帧的生成、流量控制、差错检测、重发等。这一层的数据封装为帧（Frame）
> 
> 3. 网络层(Network Layer)
>
> 网络层主要是完成路由的选择、数据报的分组、流量控制、差错检测、分组的排序等，现实网络中有很多网络结构、通信介质、参数、标准等。网络层为上层（传输层）隐藏所有的细节，向上层提供服务。在这层数据封装为IP数据包（Packet)，它的关键设备是路由器。可以认为网络层相当于完成一个邮递员的工作，当一个报文（信件）来到时，网络层（邮递员）决定走哪一条路，经过多少个路由器（邮局）到达目的地，而上层（传输层）并不关心报文如何到达目的地，它只是使用服务而已。
> 
> 4. 传输层(TransportLayer)
>
> 传输层是OSI/RM七层中最后一个在端到端层次上对通信的控制，它的作用很重要。有一个既存事实，即世界上各种通信子网在性能上存在着很大差异。例如电话交换网、分组交换网、公用数据交换网、局域网等通信子网都可互连，但它们提供的吞吐量、传输速率、数据延迟通信费用各不相同。对于会话层来说，却要求有一个性能恒定的界面。传输层就承担了这一功能，它采用分流/合流，复用/介复用技术来调节上述通信子网的差异，使会话层感受不到下层的诸多不同。传输层隐藏所用的细节为上层提供一个透明的服务。传输层提供流量控制、差错控制、数据的分块等功能。传输层有两个非常重要的协议，一个是面向连接、可靠的协议TCP协议，一个是无连接、不可靠的协议UDP协议。数据在这一层封装为分组（Segment）
> 
> 5. 会话层（SessionLayer）
> 
> 会话层提供服务、会话的建立和维持会话，使会话获得同步、完成会话的终止。这里用一个例子来说明：用户在登陆一个邮箱时，需要进行用户名、密码的验证，这个时候就可以认为是会话建立阶段，用户输入信息并验证成功后，这个时候认为是会话的保持阶段，用户在权限范围内进行一些操作，当用户完成工作要退出时，会话层会完成会话的结束。
> 
> 6. 表示层（PresentationLayer)
> 
> 表示层主要解决用户信息的语法表示问题。它将欲交换的数据从适合于某一用户的抽象语法，转换为适合于OSI系统内部使用的传送语法。即提供格式化的表示和转换数据服务。数据的压缩和解压缩，加密和解密等工作都由表示层负责。例如图像格式的显示，就是由位于表示层的协议来支持。这里，可以用一个例子来说明，假设有10个来自世界各地的人在开会，他们各自使用母语交流，将会因为语言格式不一样而导致交流失败。假如每一个人在发言时都将发言的内容转换成一种世界语（如英语），那么再进行对话时，大家都使用了世界语，自然可以成功。
> 
> 7. 应用层（Application Layer)
>
>应用层为操作系统或网络应用程序提供访问网络服务的接口。应用层协议的代表包括：Telnet、FTP、HTTP、SNMP等。应用层应该不难理解，可以简单的认为应用层就是网络服务与应用程序的一个桥梁，我们访问基于网络的程序（如收发邮件、即时聊天等）时，应用层帮我们完成了网络的访问。

## 常用协议
> 1. TCP/IP协议
> 
> TCP/IP协议作为互联网的基础协议，没有它就根本不可能上网，任何和互联网有关的操作都离不开TCP/IP协议。不过TCP/IP协议也是这三大协议中配置起来最麻烦的一个，单机上网还好，而通过局域网访问互联网的话，就要详细设置IP地址，网关，子网掩码，DNS服务器等参数。
> 
> TCP/IP尽管是目前最流行的网络协议，但TCP/IP协议在局域网中的通信效率并不高，使用它在浏览“网上邻居”中的计算机时，经常会出现不能正常浏览的现象。此时安装NetBEUI协议就会解决这个问题。
> 
> 2. NetBEUI协议
> 
> NetBEUI即NetBios Enhanced User Interface ，或NetBios增强用户接口。它是NetBIOS协议的增强版本，曾被许多操作系统采用，例如Windows for Workgroup、Win 9x系列、Windows NT等。NETBEUI协议在许多情形下很有用，是WINDOWS98之前的操作系统的缺省协议。NetBEUI协议是一种短小精悍、通信效率高的广播型协议，安装后不需要进行设置，特别适合于在“网络邻居”传送数据。所以建议除了TCP/IP协议之外，小型局域网的计算机也可以安上NetBEUI协议。另外还有一点要注意，如果一台只装了TCP/IP协议的WINDOWS98机器要想加入到WINNT域，也必须安装NetBEUI协议。
> 
> 3. IPX/SPX协议
> 
> IPX/SPX协议本来就是Novell开发的专用于NetWare网络中的协议，但是也非常常用--大部分可以联机的游戏都支持IPX/SPX协议，比如星际争霸，反恐精英等等。虽然这些游戏通过TCP/IP协议也能联机，但显然还是通过IPX/SPX协议更省事，因为根本不需要任何设置。除此之外，IPX/SPX协议在非局域网络中的用途似乎并不是很大.如果确定不在局域网中联机玩游戏，那么这个协议可有可无。
