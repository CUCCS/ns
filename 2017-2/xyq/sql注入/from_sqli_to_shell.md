# 从SQL注入到Shell

## 实验环境说明

* 攻击机和靶机的网络设置均为NAT网络，IP地址如下图所示。  
目标服务器：下载镜像，VirtualBox加载
[](pic\01.PNG)  
攻击机  
![](pic\02.PNG)  

## 实验过程

### 指纹识别

* 使用nmap查看端口开放情况。
![](pic\1.PNG)

* 使用浏览器访问目标服务器，通过burpsuite查看response包，可获得目标服务器相关信息。
![](pic\03.PNG)

* 使用wfuzz获取目标服务器上的文件目录。
![](pic\1_3.PNG)

### 检测并利用SQL注入漏洞

* 通过地址 http://10.0.2.7/cat.php?id=1 获取的页面  
![](pic\2-1.PNG)  
![](pic\2-2.PNG)
与 http://10.0.2.7/cat.php?id=2-1时获取页面相同，所以存在SQL注入漏洞。  
![](pic\2-3.PNG)  
![](pic\2-4.PNG)   

* union测试  
  通过反复测试，可以知道select语句选择的列有4列  
![](pic\2-5.PNG)

* 获取数据库版本信息。与之前正常页面对比可获得信息显示位置。
![](pic\3-1.PNG)

* 获取数据库表名和列名，发现用户名表。
![](pic\3-2.PNG)

* 在用户名表中查询用户名和密码。
![](pic\3-3.PNG)  

* 获取密码的MD5值，借助线上网站解码。
![](pic\3-4.PNG)

### 进入管理页面，代码执行

* 使用用户名密码成功登录，可以进行上传删除图片的操作。
![](pic\4-1.PNG)

* 在本地建立shell.php文件。  
![](pic\4-2.PNG)  
这段代码的意思是将GET的参数中cmd的内容作为命令执行  

* 上传文件显示NO PHP!禁止上传php文件，尝试将.php改为.php3.成功上传
![](pic\4-4.PNG)  
![](pic\4-3.PNG)  
![](pic\4-6.PNG)

* 通过查看页面元素获取webshell地址。
![](pic\4-7.PNG)

* 利用webshell读取目标服务器passwd文件。
![](pic\4-8.PNG)   
